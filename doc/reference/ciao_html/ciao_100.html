<HTML>
<HEAD>
<!-- Created by texi2html 1.56k + clip patches and <A href="http://www.clip.dia.fi.upm.es/Software">lpdoc</A> from ciao.texi on 16 May 2002 -->

<LINK rel="stylesheet" href="ciao.css" type="text/css">
<TITLE>The Ciao Prolog System               - Delaying predicates (when)</TITLE>
</HEAD>
<BODY> 
Go to the <A HREF="ciao_1.html">first</A>, <A HREF="ciao_99.html">previous</A>, <A HREF="ciao_101.html">next</A>, <A HREF="ciao_215.html">last</A> section, <A HREF="ciao_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC406" HREF="ciao_toc.html#TOC406">Delaying predicates (when)</A></H1>
<P>
<A NAME="IDX4354"></A>


<P>
<STRONG>Author(s):</STRONG> Manuel Carro.


<P>
<STRONG>Version:</STRONG> 1.8 (2002/5/16, 21:20:27 CEST)


<P>
<STRONG>Version of last change:</STRONG> 1.7#3 (2000/7/21, 11:54:59 CEST)


<P>
 


<P>
<A NAME="IDX4355"></A>
<CODE>when/2</CODE> delays a predicate until some condition in its variable is met. For example, we may want to find out the maximum of two numbers, but we are not sure when they will be instantiated. We can write the standard 
<A NAME="IDX4356"></A>
<CODE>max/3</CODE> predicate (but changing its name to 
<A NAME="IDX4357"></A>
<CODE>gmax/3</CODE> to denote that the first and second arguments must be ground) as 



<PRE>
gmax(X, Y, X):- X &#62; Y, !.
gmax(X, Y, Y):- X =&#60; Y.
</PRE>

<P>
and then define a 'safe' 
<A NAME="IDX4358"></A>
<CODE>max/3</CODE> as 
 

<PRE>
max(X, Y, Z):-
        when((ground(X),ground(Y)), gmax(X, Y, Z)).
</PRE>

<P>
which can be called as follows: 



<PRE>
?- max(X, Y, Z) , Y = 0, X = 8.

X = 8,
Y = 0,
Z = 8 ? 

yes
</PRE>

<P>
Alternatively, 
<A NAME="IDX4359"></A>
<CODE>max/3</CODE> could have been defined as 



<PRE>
max(X, Y, Z):-
        when(ground((X, Y)), gmax(X, Y, Z)).
</PRE>

<P>
with the same effects as above. More complex implementations are possible. Look, for example, at the <CODE>max.pl</CODE> implementation under the <CODE>when</CODE> library directory, where a 
<A NAME="IDX4360"></A>
<CODE>max/3</CODE> predicate is implemented which waits on all the arguments until there is enough information to determine their values: 



<PRE>
?- use_module(library('when/max')).

yes
?- max(X, Y, Z), Z = 5, Y = 4.

X = 5,
Y = 4,
Z = 5 ? 

yes
</PRE>


<UL>
<LI><A HREF="ciao_100.html#SEC407">Usage and interface (when)</A>
<LI><A HREF="ciao_100.html#SEC408">Documentation on exports (when)</A>
<LI><A HREF="ciao_100.html#SEC409">Documentation on multifiles (when)</A>
<LI><A HREF="ciao_100.html#SEC410">Known bugs and planned improvements (when)</A>
</UL>



<H2><A NAME="SEC407" HREF="ciao_toc.html#TOC407">Usage and interface (<CODE>when</CODE>)</A></H2>

<div class="cartouche">

<UL>

<LI><STRONG>Library usage:</STRONG>

<CODE>:- use_module(library(when)).</CODE>

<LI><STRONG>Exports:</STRONG>


<UL>

<LI><EM>Predicates:</EM>

<A NAME="IDX4361"></A>
<CODE>when/2</CODE>.

<LI><EM>Regular Types:</EM>

<A NAME="IDX4362"></A>
<CODE>wakeup_exp/1</CODE>.

<LI><EM>Multifiles:</EM>

<A NAME="IDX4363"></A>
<CODE>verify_attribute/2</CODE>, 
<A NAME="IDX4364"></A>
<CODE>combine_attributes/2</CODE>.

</UL>

<LI><STRONG>Other modules used:</STRONG>


<UL>

<LI><EM>System library modules:</EM>

<A NAME="IDX4365"></A>
<CODE>terms_vars</CODE>, 
<A NAME="IDX4366"></A>
<CODE>sort</CODE>, 
<A NAME="IDX4367"></A>
<CODE>sets</CODE>.

</UL>

</UL>

</div class="cartouche">



<H2><A NAME="SEC408" HREF="ciao_toc.html#TOC408">Documentation on exports (<CODE>when</CODE>)</A></H2>
<P>
<A NAME="IDX4368"></A>
<A NAME="IDX4369"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>when/2:</B>
<DD><A NAME="IDX4370"></A>


<P>
<EM>Meta-predicate</EM> with arguments: <CODE>when(?,goal)</CODE>.


<P>
<STRONG>Usage:</STRONG> <CODE>when(WakeupCond,Goal)</CODE>

<UL>
<LI><EM>Description:</EM> Delays / executes <CODE>Goal</CODE> according to <CODE>WakeupCond</CODE> given. The <CODE>WakeupCond</CODE>s now acceptable are <CODE>ground(T)</CODE> (

<A NAME="IDX4371"></A>
<CODE>Goal</CODE> is delayed until <CODE>T</CODE> is ground), <CODE>nonvar(T)</CODE> (
<A NAME="IDX4372"></A>
<CODE>Goal</CODE> is delayed until <CODE>T</CODE> is not a variable), and conjunctions and disjunctions of conditions: 


<PRE>
wakeup_exp(ground(_1)).
wakeup_exp(nonvar(_1)).
wakeup_exp((C1,C2)) :-
        wakeup_exp(C1),
        wakeup_exp(C2).
wakeup_exp((C1;C2)) :-
        wakeup_exp(C1),
        wakeup_exp(C2).
</PRE>

<A NAME="IDX4373"></A>
<CODE>when/2</CODE> only fails it the <CODE>WakeupCond</CODE> is not legally formed. If <CODE>WakeupCond</CODE> is met at the time of the call no delay mechanism is involved -- but there exists a time penalty in the condition checking. 

In case that an instantiation fires the execution of several predicates, the order in which these are executed is not defined. 
<LI><EM>The following properties should hold at call time:</EM>

<CODE>WakeupCond</CODE> is a legal expression for delaying goals.
 (<CODE>when:wakeup_exp/1</CODE>)

<CODE>Goal</CODE> is a term which represents a goal, i.e., an atom or a structure.
 (<CODE>basic_props:callable/1</CODE>)
</UL>

</DL>

<P>
<A NAME="IDX4374"></A>
<A NAME="IDX4375"></A>
<DL>
<DT><span class="define">REGTYPE:</span> <B>wakeup_exp/1:</B>
<DD><A NAME="IDX4376"></A>


<P>
<STRONG>Usage:</STRONG> <CODE>wakeup_exp(T)</CODE>

<UL>
<LI><EM>Description:</EM> <CODE>T</CODE> is a legal expression for delaying goals.

</UL>

</DL>



<H2><A NAME="SEC409" HREF="ciao_toc.html#TOC409">Documentation on multifiles (<CODE>when</CODE>)</A></H2>
<P>
<A NAME="IDX4377"></A>
<A NAME="IDX4378"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>verify_attribute/2:</B>
<DD><A NAME="IDX4379"></A>


<P>
No further documentation available for this predicate.


<P>
The predicate is <EM>multifile</EM>.


</DL>

<P>
<A NAME="IDX4380"></A>
<A NAME="IDX4381"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>combine_attributes/2:</B>
<DD><A NAME="IDX4382"></A>


<P>
No further documentation available for this predicate.


<P>
The predicate is <EM>multifile</EM>.


</DL>



<H2><A NAME="SEC410" HREF="ciao_toc.html#TOC410">Known bugs and planned improvements (<CODE>when</CODE>)</A></H2>


<UL>

<LI>

Redundant conditions are not removed.

<LI>

Floundered goals are not appropriately printed.
</UL>

<P><HR><P>
Go to the <A HREF="ciao_1.html">first</A>, <A HREF="ciao_99.html">previous</A>, <A HREF="ciao_101.html">next</A>, <A HREF="ciao_215.html">last</A> section, <A HREF="ciao_toc.html">table of contents</A>.
</BODY>
</HTML>
