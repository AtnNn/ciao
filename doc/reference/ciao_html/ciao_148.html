<HTML>
<HEAD>
<!-- Created by texi2html 1.56k + clip patches and <A href="http://www.clip.dia.fi.upm.es/Software">lpdoc</A> from ciao.texi on 31 December 2003 -->

<LINK rel="stylesheet" href="ciao.css" type="text/css">
<TITLE>The Ciao Prolog System               - HTML/XML/CGI programming</TITLE>
</HEAD>
<BODY> 
Go to the <A HREF="ciao_1.html">first</A>, <A HREF="ciao_147.html">previous</A>, <A HREF="ciao_149.html">next</A>, <A HREF="ciao_240.html">last</A> section, <A HREF="ciao_toc.html">table of contents</A>.
<P><HR><P>


<H1><A NAME="SEC606" HREF="ciao_toc.html#TOC606">HTML/XML/CGI programming</A></H1>
<P>
<A NAME="IDX6204"></A>


<P>
<STRONG>Author(s):</STRONG> Daniel Cabeza, Manuel Hermenegildo, Sacha Varma.


<P>
<STRONG>Version:</STRONG> 1.11#120 (2003/12/22, 23:35:35 CET)


<P>
<STRONG>Version of last change:</STRONG> 1.11#26 (2003/7/15, 19:2:36 CEST)


<P>
This module implements the predicates of the PiLLoW package related to 
<A NAME="IDX6205"></A>
HTML/
<A NAME="IDX6206"></A>
XML generation and parsing, 
<A NAME="IDX6207"></A>
CGI and form handlers programming, and in general all the predicates which do not imply the use of the HTTP protocol.



<UL>
<LI><A HREF="ciao_148.html#SEC607">Usage and interface (html)</A>
<LI><A HREF="ciao_148.html#SEC608">Documentation on exports (html)</A>
<LI><A HREF="ciao_148.html#SEC609">Documentation on multifiles (html)</A>
<LI><A HREF="ciao_148.html#SEC610">Other information (html)</A>
</UL>



<H2><A NAME="SEC607" HREF="ciao_toc.html#TOC607">Usage and interface (<CODE>html</CODE>)</A></H2>

<div class="cartouche">

<UL>

<LI><STRONG>Library usage:</STRONG>

<CODE>:- use_module(library(html)).</CODE>

<LI><STRONG>Exports:</STRONG>


<UL>

<LI><EM>Predicates:</EM>

<A NAME="IDX6208"></A>
<CODE>output_html/1</CODE>, 
<A NAME="IDX6209"></A>
<CODE>html2terms/2</CODE>, 
<A NAME="IDX6210"></A>
<CODE>xml2terms/2</CODE>, 
<A NAME="IDX6211"></A>
<CODE>html_template/3</CODE>, 
<A NAME="IDX6212"></A>
<CODE>html_report_error/1</CODE>, 
<A NAME="IDX6213"></A>
<CODE>get_form_input/1</CODE>, 
<A NAME="IDX6214"></A>
<CODE>get_form_value/3</CODE>, 
<A NAME="IDX6215"></A>
<CODE>form_empty_value/1</CODE>, 
<A NAME="IDX6216"></A>
<CODE>form_default/3</CODE>, 
<A NAME="IDX6217"></A>
<CODE>set_cookie/2</CODE>, 
<A NAME="IDX6218"></A>
<CODE>get_cookies/1</CODE>, 
<A NAME="IDX6219"></A>
<CODE>url_query/2</CODE>, 
<A NAME="IDX6220"></A>
<CODE>url_query_values/2</CODE>, 
<A NAME="IDX6221"></A>
<CODE>my_url/1</CODE>, 
<A NAME="IDX6222"></A>
<CODE>url_info/2</CODE>, 
<A NAME="IDX6223"></A>
<CODE>url_info_relative/3</CODE>, 
<A NAME="IDX6224"></A>
<CODE>form_request_method/1</CODE>, 
<A NAME="IDX6225"></A>
<CODE>icon_address/2</CODE>, 
<A NAME="IDX6226"></A>
<CODE>html_protect/1</CODE>, 
<A NAME="IDX6227"></A>
<CODE>http_lines/3</CODE>.

<LI><EM>Multifiles:</EM>

<A NAME="IDX6228"></A>
<CODE>define_flag/3</CODE>, 
<A NAME="IDX6229"></A>
<CODE>html_expansion/2</CODE>.

</UL>

<LI><STRONG>Other modules used:</STRONG>


<UL>

<LI><EM>System library modules:</EM>

<A NAME="IDX6230"></A>
<CODE>strings</CODE>, 
<A NAME="IDX6231"></A>
<CODE>lists</CODE>, 
<A NAME="IDX6232"></A>
<CODE>system</CODE>, 
<A NAME="IDX6233"></A>
<CODE>pillow/pillow_aux</CODE>, 
<A NAME="IDX6234"></A>
<CODE>pillow/pillow_types</CODE>.

</UL>

</UL>

</div class="cartouche">



<H2><A NAME="SEC608" HREF="ciao_toc.html#TOC608">Documentation on exports (<CODE>html</CODE>)</A></H2>
<P>
<A NAME="IDX6235"></A>
<A NAME="IDX6236"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>output_html/1:</B>
<DD><A NAME="IDX6237"></A>


<P>
<CODE>output_html(HTMLTerm)</CODE>


<P>
Outputs <CODE>HTMLTerm</CODE>, interpreted as an 
<A NAME="IDX6238"></A>
<CODE>html_term/1</CODE>, to current output stream.


</DL>

<P>
<A NAME="IDX6239"></A>
<A NAME="IDX6240"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>html2terms/2:</B>
<DD><A NAME="IDX6241"></A>


<P>
<CODE>html2terms(String, Terms)</CODE>


<P>
<CODE>String</CODE> is a character list containing HTML code and <CODE>Terms</CODE> is its prolog structured representation.


<P>
<STRONG>Usage 1:</STRONG> <CODE>html2terms(-string, +html_term)</CODE>

<UL>
<LI><EM>Description:</EM> Translates an HTML-term into the HTML code it represents.

</UL>

<P>
<STRONG>Usage 2:</STRONG> <CODE>html2terms(+string, ?canonic_html_term)</CODE>

<UL>
<LI><EM>Description:</EM> Translates HTML code into a structured HTML-term.

</UL>

</DL>

<P>
<A NAME="IDX6242"></A>
<A NAME="IDX6243"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>xml2terms/2:</B>
<DD><A NAME="IDX6244"></A>


<P>
<CODE>xml2terms(String, Terms)</CODE>


<P>
<CODE>String</CODE> is a character list containing XML code and <CODE>Terms</CODE> is its prolog structured representation.


<P>
<STRONG>Usage 1:</STRONG> <CODE>xml2terms(-string, +html_term)</CODE>

<UL>
<LI><EM>Description:</EM> Translates a XML-term into the XML code it represents.

</UL>

<P>
<STRONG>Usage 2:</STRONG> <CODE>xml2terms(+string, ?canonic_xml_term)</CODE>

<UL>
<LI><EM>Description:</EM> Translates XML code into a structured XML-term.

</UL>

</DL>

<P>
<A NAME="IDX6245"></A>
<A NAME="IDX6246"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>html_template/3:</B>
<DD><A NAME="IDX6247"></A>


<P>
<CODE>html_template(Chars, Terms, Dict)</CODE>


<P>
Interprets <CODE>Chars</CODE> as an HTML template returning in <CODE>Terms</CODE> the corresponding structured HTML-term, which includes variables, and unifying <CODE>Dict</CODE> with a dictionary of those variables (an incomplete list of <EM>name</EM><CODE>=</CODE><EM>Var</EM> pairs). An HTML template is standard HTML code, but in which "slots" can be defined and given an identifier. These slots represent parts of the HTML code in which other HTML code can be inserted, and are represented in the HTML-term as free variables. There are two kinds of variables in templates: 

<UL>

<LI>Variables representing page contents. A variable with name <EM>name</EM> is defined with the special tag <CODE>&#60;V&#62;</CODE><EM>name</EM><CODE>&#60;/V&#62;</CODE>.

<LI>Variables representing tag attributes. They occur as an attribute or an attribute value starting with <CODE>_</CODE>, followed by its name, which must be formed by alphabetic characters.

</UL>

<P>
As an example, suposse the following HTML template: 

<PRE>
&#60;html&#62;
&#60;body bgcolor=_bgcolor&#62;
&#60;v&#62;content&#60;/v&#62;
&#60;/body&#62;
&#60;/html&#62;

</PRE>

<P>
The following query in the Ciao toplevel shows how the template is parsed, and the dictionary returned: 

<PRE>
?- file_to_string('template.html',_S), html_template(_S,Terms,Dict). 

Dict = [bgcolor=_A,content=_B|_],
Terms = [env(html,[],["
",env(body,[bgcolor=_A],["
",_B,"
"]),"
"]),"
"] ? 

yes
</PRE>

<P>
If a dictionary with values is supplied at call time, then variables are unified accordingly inside the template: 

<PRE>
?- file_to_string('template.html',_S),
   html_template(_S,Terms,[content=b("hello world!"),bgcolor="white"]). 

Terms = [env(html,[],["
",env(body,[bgcolor="white"],["
",b("hello world!"),"
"]),"
"]),"
"] ? 

yes
</PRE>

</DL>

<P>
<A NAME="IDX6248"></A>
<A NAME="IDX6249"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>html_report_error/1:</B>
<DD><A NAME="IDX6250"></A>


<P>
<STRONG>Usage:</STRONG> <CODE>html_report_error(Error)</CODE>

<UL>
<LI><EM>Description:</EM> Outputs error <CODE>Error</CODE> as a standard HTML page.

</UL>

</DL>

<P>
<A NAME="IDX6251"></A>
<A NAME="IDX6252"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>get_form_input/1:</B>
<DD><A NAME="IDX6253"></A>


<P>
<CODE>get_form_input(Dict)</CODE>


<P>
Translates input from the form (with either the POST or GET methods, and even with CONTENT_TYPE multipart/form-data) to a dictionary <CODE>Dict</CODE> of <EM>attribute</EM>=<EM>value</EM> pairs. If the flag <CODE>raw_form_values</CODE> is <CODE>off</CODE> (which is the default state), it translates empty values (which indicate only the presence of an attribute) to the atom <CODE>'$empty'</CODE>, values with more than one line (from text areas or files) to a list of lines as strings, the rest to atoms or numbers (using 
<A NAME="IDX6254"></A>
<CODE>name/2</CODE>). If the flag <CODE>on</CODE>, it gives all values as atoms, without translations.


</DL>

<P>
<A NAME="IDX6255"></A>
<A NAME="IDX6256"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>get_form_value/3:</B>
<DD><A NAME="IDX6257"></A>


<P>
<CODE>get_form_value(Dict, Var, Val)</CODE>


<P>
Unifies <CODE>Val</CODE> with the value for attribute <CODE>Var</CODE> in dictionary <CODE>Dict</CODE>. Does not fail: value is <CODE>"</CODE> if not found (this simplifies the programming of form handlers when they can be accessed directly).


</DL>

<P>
<A NAME="IDX6258"></A>
<A NAME="IDX6259"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>form_empty_value/1:</B>
<DD><A NAME="IDX6260"></A>


<P>
<STRONG>Usage:</STRONG> <CODE>form_empty_value(Term)</CODE>

<UL>
<LI><EM>Description:</EM> Checks that <CODE>Term</CODE>, a value comming from a text area is empty (can have spaces, newlines and linefeeds).

</UL>

</DL>

<P>
<A NAME="IDX6261"></A>
<A NAME="IDX6262"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>form_default/3:</B>
<DD><A NAME="IDX6263"></A>


<P>
<STRONG>Usage:</STRONG> <CODE>form_default(+Val, +Default, -NewVal)</CODE>

<UL>
<LI><EM>Description:</EM> Useful when a form is only partially filled, or when the executable can be invoked either by a link or by a form, to set form defaults. If the value of <CODE>Val</CODE> is empty then <CODE>NewVal</CODE>=<CODE>Default</CODE>, else <CODE>NewVal</CODE>=<CODE>Val</CODE>.

</UL>

</DL>

<P>
<A NAME="IDX6264"></A>
<A NAME="IDX6265"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>set_cookie/2:</B>
<DD><A NAME="IDX6266"></A>


<P>
<CODE>set_cookie(Name, Value)</CODE>


<P>
Sets a cookie of name <CODE>Name</CODE> and value <CODE>Value</CODE>. Must be invoked before outputting any data, including the <CODE>cgi_reply</CODE> html-term.


</DL>

<P>
<A NAME="IDX6267"></A>
<A NAME="IDX6268"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>get_cookies/1:</B>
<DD><A NAME="IDX6269"></A>


<P>
<CODE>get_cookies(Cookies)</CODE>


<P>
Unifies <CODE>Cookies</CODE> with a dictionary of <EM>attribute</EM>=<EM>value</EM> pairs of the active cookies for this URL. If the flag <CODE>raw_form_values</CODE> is <CODE>on</CODE>, <EM>value</EM>s are always atoms even if they could be interpreted as numbers.


</DL>

<P>
<A NAME="IDX6270"></A>
<A NAME="IDX6271"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>url_query/2:</B>
<DD><A NAME="IDX6272"></A>


<P>
<CODE>url_query(Dict, URLArgs)</CODE>


<P>
(Deprecated, see 
<A NAME="IDX6273"></A>
<CODE>url_query_values/2</CODE>) Translates a dictionary <CODE>Dict</CODE> of parameter values into a string <CODE>URLArgs</CODE> for appending to a URL pointing to a form handler.


</DL>

<P>
<A NAME="IDX6274"></A>
<A NAME="IDX6275"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>url_query_values/2:</B>
<DD><A NAME="IDX6276"></A>


<P>
<CODE>url_query_values(Dict, URLArgs)</CODE>


<P>
<CODE>Dict</CODE> is a dictionary of parameter values and <CODE>URLArgs</CODE> is the URL-encoded string of those assignments, which may appear after an URL pointing to a CGI script preceded by a '?'. <CODE>Dict</CODE> is computed according to the <CODE>raw_form_values</CODE> flag. The use of this predicate is reversible.


</DL>

<P>
<A NAME="IDX6277"></A>
<A NAME="IDX6278"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>my_url/1:</B>
<DD><A NAME="IDX6279"></A>


<P>
<CODE>my_url(URL)</CODE>


<P>
Unifies <CODE>URL</CODE> with the Uniform Resource Locator (WWW address) of this cgi executable.


</DL>

<P>
<A NAME="IDX6280"></A>
<A NAME="IDX6281"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>url_info/2:</B>
<DD><A NAME="IDX6282"></A>


<P>
<CODE>url_info(URL, URLTerm)</CODE>


<P>
Translates a URL <CODE>URL</CODE> to a Prolog structure <CODE>URLTerm</CODE> which details its various components, and vice-versa. For now non-HTTP URLs make the predicate fail.


</DL>

<P>
<A NAME="IDX6283"></A>
<A NAME="IDX6284"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>url_info_relative/3:</B>
<DD><A NAME="IDX6285"></A>


<P>
<CODE>url_info_relative(URL, BaseURLTerm, URLTerm)</CODE>


<P>
Translates a relative URL <CODE>URL</CODE> which appears in the HTML page refered to by <CODE>BaseURLTerm</CODE> into <CODE>URLTerm</CODE>, a Prolog structure containing its absolute parameters. Absolute URLs are translated as with 
<A NAME="IDX6286"></A>
<CODE>url_info/2</CODE>. E.g. 

<PRE>
url_info_relative("dadu.html",
                  http('www.foo.com',80,"/bar/scoob.html"), Info)
</PRE>

<P>
gives <CODE>Info = http('www.foo.com',80,"/bar/dadu.html")</CODE>.


</DL>

<P>
<A NAME="IDX6287"></A>
<A NAME="IDX6288"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>form_request_method/1:</B>
<DD><A NAME="IDX6289"></A>


<P>
<STRONG>Usage:</STRONG> <CODE>form_request_method(Method)</CODE>

<UL>
<LI><EM>Description:</EM> Unifies <CODE>Method</CODE> with the method of invocation of the form handler (<CODE>GET</CODE> or <CODE>POST</CODE>).

<LI><EM>The following properties hold upon exit:</EM>

<CODE>Method</CODE> is an atom.
 (<CODE>basic_props:atm/1</CODE>)
</UL>

</DL>

<P>
<A NAME="IDX6290"></A>
<A NAME="IDX6291"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>icon_address/2:</B>
<DD><A NAME="IDX6292"></A>


<P>
<CODE>icon_address(Img, IAddress)</CODE>


<P>
The PiLLoW image <CODE>Img</CODE> has URL <CODE>IAddress</CODE>.


</DL>

<P>
<A NAME="IDX6293"></A>
<A NAME="IDX6294"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>html_protect/1:</B>
<DD><A NAME="IDX6295"></A>


<P>
<CODE>html_protect(Goal)</CODE>


<P>
Calls <CODE>Goal</CODE>. If an error occurs during its execution, or it fails, an HTML page is output informing about the incident. Normaly the whole execution of a CGI is protected thus.


<P>
<EM>Meta-predicate</EM> with arguments: <CODE>html_protect(goal)</CODE>.


<P>
<STRONG>Usage:</STRONG> 

<UL>
<LI><EM>Calls should, and exit will be compatible with:</EM>

<CODE>Goal</CODE> is a term which represents a goal, i.e., an atom or a structure.
 (<CODE>basic_props:callable/1</CODE>)
</UL>

</DL>

<P>
<A NAME="IDX6296"></A>
<A NAME="IDX6297"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>http_lines/3:</B>
<DD><A NAME="IDX6298"></A>


<P>
<STRONG>Usage:</STRONG> <CODE>http_lines(Lines, String, Tail)</CODE>

<UL>
<LI><EM>Description:</EM> <CODE>Lines</CODE> is a list of the lines with occur in <CODE>String</CODE> until <CODE>Tail</CODE>. The lines may end UNIX-style or DOS-style in <CODE>String</CODE>, in <CODE>Lines</CODE> they have not end of line characters. Suitable to be used in DCGs.

<LI><EM>Calls should, and exit will be compatible with:</EM>

<CODE>Lines</CODE> is a list of <CODE>string</CODE>s.
 (<CODE>basic_props:list/2</CODE>)

<CODE>String</CODE> is a string (a list of character codes).
 (<CODE>basic_props:string/1</CODE>)

<CODE>Tail</CODE> is a string (a list of character codes).
 (<CODE>basic_props:string/1</CODE>)
</UL>

</DL>



<H2><A NAME="SEC609" HREF="ciao_toc.html#TOC609">Documentation on multifiles (<CODE>html</CODE>)</A></H2>
<P>
<A NAME="IDX6299"></A>
<A NAME="IDX6300"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>define_flag/3:</B>
<DD><A NAME="IDX6301"></A>


<P>
Defines a flag as follows: 

<PRE>
define_flag(raw_form_values,[on,off],off).
</PRE>

<P>
(See section <A HREF="ciao_27.html#SEC160">Changing system behaviour and various flags</A>). 


<P>
If flag is <CODE>on</CODE>, values returned by 
<A NAME="IDX6302"></A>
<CODE>get_form_input/1</CODE> are always atoms, unchanged from its original value.


<P>
The predicate is <EM>multifile</EM>.


</DL>

<P>
<A NAME="IDX6303"></A>
<A NAME="IDX6304"></A>
<DL>
<DT><span class="define">PREDICATE:</span> <B>html_expansion/2:</B>
<DD><A NAME="IDX6305"></A>


<P>
The predicate is <EM>multifile</EM>.


<P>
<STRONG>Usage:</STRONG> <CODE>html_expansion(Term, Expansion)</CODE>

<UL>
<LI><EM>Description:</EM> Hook predicate to define macros. Expand occurrences of <CODE>Term</CODE> into <CODE>Expansion</CODE>, in

<A NAME="IDX6306"></A>
<CODE>output_html/1</CODE>. Take care to not transform something into itself! 
</UL>

</DL>



<H2><A NAME="SEC610" HREF="ciao_toc.html#TOC610">Other information (<CODE>html</CODE>)</A></H2>

<P>
The code uses input from from L. Naish's forms and F. Bueno's previous Chat interface. Other people who have contributed is (please inform us if we leave out anybody): Markus Fromherz, Samir Genaim.


<P><HR><P>
Go to the <A HREF="ciao_1.html">first</A>, <A HREF="ciao_147.html">previous</A>, <A HREF="ciao_149.html">next</A>, <A HREF="ciao_240.html">last</A> section, <A HREF="ciao_toc.html">table of contents</A>.
</BODY>
</HTML>
